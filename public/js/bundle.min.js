class Grid{constructor(t,e){this._el=t;this._tools=e;this.parts={hHead:".tbl-col-head > div:nth-child(1)",hBody:".tbl-col-head > div:nth-child(2)",bHead:".tbl-body > div:nth-child(1)",bBody:".tbl-body > div:nth-child(2)",fHead:".tbl-col-foot > div:nth-child(1)",fBody:".tbl-col-foot > div:nth-child(2)"};for(let t in this.parts){let e=this.parts[t],s=this._el.find(e);this.parts[t]={selector:e,el:s}}}paste(t){let e=this.selected?this.selected.anchor:{y:0,x:0},s=[],i=[],h=this.rows;t.map(((t,s)=>{if(!h[e.y+s]){this.addRow(e.y);h=this.rows}}));t.map(((t,l)=>{t.map(((t,o)=>{let a=e.y+l,r=e.x+o;if(!h[a][r]){this.addCol(e.x);h=this.rows}h[a][r].innerHTML=t;if(!s.includes(a))s.push(a);if(!i.includes(r))i.push(r)}))}));this.select({yNum:s,xNum:i,anchor:e})}createClone(t,e){let s;switch(e){case"td":s=t.find("td:nth(0)").clone(true)[0];s.innerHTML="";[...s.attributes].map((t=>s.removeAttribute(t.name)));break;case"tr":s=t.find("tr:nth(0)").clone(true)[0];s.childNodes.map((t=>{if(t.nodeType===Node.ELEMENT_NODE){t.innerHTML="";[...t.attributes].map((e=>t.removeAttribute(e.name)))}}));[...s.attributes].map((t=>s.removeAttribute(t.name)));break}return s}addRow(t,e="after"){let s=this.layout.cols,i=this.layout.rows,h=t!==undefined?t:i.head+i.body-1,l,o,a;switch(true){case h<i.head:l="h";break;case h>=i.head+i.body:l="f";h-=i.head+i.body;break;default:l="b";h-=i.head}if(s.head){o=this.parts[`${l}Head`];a=this.createClone(o.el,"tr");o.el.find(`tbody tr:nth(${h})`)[e](a)}o=this.parts[`${l}Body`];a=this.createClone(o.el,"tr");o.el.find(`tbody tr:nth(${h})`)[e](a);this._tools.addRow(t,e)}removeRow(t){let e=this.layout.rows,s=t!==undefined?t:e.head+e.body-1,i;switch(true){case s<e.head:i="h";break;case s>=e.head+e.body:i="f";s-=e.head+e.body;break;default:i="b";s-=e.head}this.parts[`${i}Head`].el.find(`tr:nth(${s})`).remove();this.parts[`${i}Body`].el.find(`tr:nth(${s})`).remove();this._tools.removeRow(t)}addCol(t,e="after"){let s=this.layout.cols,i=this.layout.rows,h=t!==undefined?t:s.head+s.body-1,l=this.createClone(this.parts.bBody.el,"td"),o,a;switch(true){case h<s.head:o="Head";break;default:o="Body";h-=s.head}if(i.head){this.parts[`h${o}`].el.find(`tr td:nth-child(${h+1})`).map((t=>t[e](l.cloneNode(true))))}if(i.foot){this.parts[`f${o}`].el.find(`tr td:nth-child(${h+1})`).map((t=>t[e](l.cloneNode(true))))}this.parts[`b${o}`].el.find(`tr td:nth-child(${h+1})`).map((t=>t[e](l.cloneNode(true))));this._tools.addCol(t,e)}removeCol(t){let e=this.layout.cols,s=t!==undefined?t:e.head+e.body-1,i;switch(true){case s<e.head:i="Head";break;default:i="Body";s-=e.head}this.parts[`h${i}`].el.find(`tr td:nth-child(${s+1})`).remove();this.parts[`b${i}`].el.find(`tr td:nth-child(${s+1})`).remove();this.parts[`f${i}`].el.find(`tr td:nth-child(${s+1})`).remove();this._tools.removeCol(t)}moveRows(t,e,s){let i=t.find("tbody"),h=e.find("tbody"),l=i.find("tr"),o=h.length?h.find("tr"):[],a=h.length?h.find("tr"):[];if(o.length&&a.length>s){h=i;i=e.find("tbody");[...Array(a.length-s)].map((t=>h.prepend(i[0].lastChild)))}else{if(!h.length){e.append(i[0].cloneNode(false));h=e.find("tbody")}[...Array(s-a.length)].map((t=>{while(i[0].firstChild.nodeName!=="TR"){i[0].removeChild(i[0].firstChild)}h.append(i[0].firstChild)}))}}moveCols(t,e,s){let i=t.find("tbody"),h=e.find("tbody");if(!i.length&&!h.length)return;let l=i.find("tr"),o=h.length?h.find("tr"):[],a=o.length?o.get(0).find("td"):[];if(o.length&&a.length>s){i=h;l=o;h=t.find("tbody");o=h.find("tr");l.map(((t,e)=>[...Array(a.length-s)].map((s=>o.get(e).prepend(t.lastChild)))))}else{if(!h.length){e.append(i[0].cloneNode(false));h=e.find("tbody");l.map((t=>h.append(t.cloneNode(false))));o=h.find("tr")}l.map(((t,e)=>[...Array(s-a.length)].map((s=>{while(t.firstChild.nodeName!=="TD"){t.removeChild(t.firstChild)}o.get(e).append(t.firstChild)}))))}}alter(t){switch(t.type){case"row-head":this.moveCols(this.parts.hBody.el,this.parts.hHead.el,t.num);this.moveCols(this.parts.bBody.el,this.parts.bHead.el,t.num);this.moveCols(this.parts.fBody.el,this.parts.fHead.el,t.num);break;case"col-head":this.moveRows(this.parts.bHead.el,this.parts.hHead.el,t.num);this.moveRows(this.parts.bBody.el,this.parts.hBody.el,t.num);break;case"col-foot":this.moveRows(this.parts.bHead.el,this.parts.fHead.el,t.num);this.moveRows(this.parts.bBody.el,this.parts.fBody.el,t.num);break}this._tools.syncDim(this);this._tools.syncRowsCols(this)}unselect(){this._tools.cellEditableOff();this._el.find(".selected, .anchor").removeClass("selected anchor");this._selected=false;this._tools._selection.removeClass("show").css({top:1e5,left:1e5,width:-100,height:-100});this._tools.unselect()}select(t){let e=t.xNum.length?t.xNum:[t.xNum],s=t.yNum.length?t.yNum:[t.yNum],i=this.rows,h=t.anchor[0]?{el:t.anchor}:t.anchor||{},l={top:1e5,left:1e5,width:-100,height:-100},o="tl tr bl br t b l r none".split(" "),a="";this._el.find(".anchor, .selected").removeClass("anchor selected");t.yNum=t.yNum.sort(((t,e)=>t-e));t.xNum=t.xNum.sort(((t,e)=>t-e));s=[...new Set(s)];e=[...new Set(e)];s.map((t=>{e.map((e=>{let s=i[t][e],o=this.getOffset(s),a=o.top-3,r=o.left-3,d=a+o.height+5,n=r+o.width+5,c=$(s);c.addClass("selected");if(l.top>a)l.top=a;if(l.left>r)l.left=r;if(l.width<n)l.width=n;if(l.height<d)l.height=d;if(!h.x)h={...h,x:e,y:t};if(!h.el&&h.y===t&&h.x===e){h={...h,el:c}}}))}));h.el.addClass("anchor");l.height-=l.top;l.width-=l.left;let r=this._el.find(".selected:last"),d=r.parent(),n=r.parents(".tbl-body:first");if(d[0]===d.parent().find("tr:last")[0]&&n.length)l.height+=1;l["--aH"]=h.el.prop("offsetHeight")+"px";l["--aW"]=h.el.prop("offsetWidth")+"px";if(s.length>1)a+=h.y===s[0]?"t":"b";if(e.length>1)a+=h.x===e[0]?"l":"r";if(s.length===1&&e.length===1)a="none";this._tools._selection.removeClass(o.map((t=>`anchor-${t}`)).join(" ")).addClass(`show anchor-${a}`).css(l);if(!t.editing){this._tools.cellEditableOn(h.el)}this._selected={xNum:e,yNum:s,anchor:h};this._tools.select({cols:e,rows:s})}get selected(){return this._selected}get rows(){let t,e,s=[];t=this.parts.hHead.el.find("tr");e=this.parts.hBody.el.find("tr");if(t.length)t.map(((t,i)=>s.push([...$("td",t),...e.get(i).find("td")])));else e.map(((t,e)=>s.push([...$("td",t)])));t=this.parts.bHead.el.find("tr");e=this.parts.bBody.el.find("tr");if(t.length)t.map(((t,i)=>s.push([...$("td",t),...e.get(i).find("td")])));else e.map(((t,e)=>s.push([...$("td",t)])));t=this.parts.fHead.el.find("tr");e=this.parts.fBody.el.find("tr");if(t.length)t.map(((t,i)=>s.push([...$("td",t),...e.get(i).find("td")])));else e.map(((t,e)=>s.push([...$("td",t)])));return s}get cells(){let t=[];this.rows.map((e=>t.push(...e)));return t}get layout(){let t={},e={},s,i;s=this.parts.hHead.el.find("tr");i=this.parts.hBody.el.find("tr");t.head=s.length||i.length;s=this.parts.bHead.el.find("tr");i=this.parts.bBody.el.find("tr");t.body=s.length||i.length;e.head=s.length?s.get(0).find("td").length:0;e.body=i.get(0).find("td").length;s=this.parts.fHead.el.find("tr");i=this.parts.fBody.el.find("tr");t.foot=s.length||i.length;return{rows:t,cols:e}}get width(){return this._el.find(".tbl-body > div > table").reduce(((t,e)=>t+e.offsetWidth),0)}get height(){return this._el.find(".tbl-root div > div:nth-child(2) > table").reduce(((t,e)=>t+e.offsetHeight),0)}get dimension(){let t=this.layout,e=t.rows.head+t.rows.body+t.rows.foot,s=t.cols.head+t.cols.body,i={rows:0,cols:0,height:0,width:0};this.rows.map(((t,e)=>{let s=false;t.map(((t,h)=>{s=!!t.innerHTML;if(s){i.width=Math.max(i.width,t.offsetLeft+t.offsetWidth);i.height=Math.max(i.height,t.offsetTop+t.offsetHeight);i.rows=Math.max(i.rows,e+1);i.cols=Math.max(i.cols,h+1)}}))}));return{rows:e,cols:s,min:i}}getRowCells(t){return $(this.rows[t])}getCoordCell(t,e){return $(this.getRowCells(t)[e])}getCoordRow(t){let e=this.layout,s=[];if(e.cols.head>0)s.push(this.getRowCells(t)[0]);if(e.cols.body>0)s.push(this.getRowCells(t)[e.cols.head]);return $(s)}getCoordCol(t){let e=this.layout,s=[];if(e.rows.head>0)s.push(this.getRowCells(0)[t]);if(e.rows.body>0)s.push(this.getRowCells(e.rows.head)[t]);if(e.rows.foot>0)s.push(this.getRowCells(e.rows.head+e.rows.body)[t]);return $(s)}getCoord(t){for(let e=0,s=this.rows.length;e<s;e++){let s=this.rows[e];for(let i=0,h=s.length;i<h;i++){if(s[i]===t)return[e,i]}}}getOffset(t){let e=t.getBoundingClientRect(),s=this._el[0].getBoundingClientRect(),i=Math.floor(e.top-s.top),h=Math.floor(e.left-s.left),l=e.width,o=e.height;return{top:i,left:h,width:l,height:o}}}class GridTools{constructor(t){this._el=t.find(".table-tools");this._cols=this._el.find(".table-cols");this._rows=this._el.find(".table-rows");this._selection=this._el.find(".selection");this.parts={cHead:".table-cols > div:nth-child(1)",cBody:".table-cols > div:nth-child(2)",rHead:".table-rows > div:nth-child(1)",rBody:".table-rows > div:nth-child(2)",rFoot:".table-rows > div:nth-child(3)"};for(let t in this.parts){let e=this.parts[t],s=this._el.find(e);this.parts[t]={selector:e,el:s}}}cellEditableOff(){if(this._anchor){let t=this._anchor.find("> div[contenteditable]").html();if(t==parseInt(t,10))this._anchor.attr({t:"n"});else this._anchor.removeAttr("t");this._anchor.html(t);this._anchor=false}}cellEditableOn(t){if(!t.find("div[contenteditable]").length){let e=`<div autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true">${t.html()}</div>`;t.html(e)}this._anchor=t}createClones(){if(this._TD!==undefined)return;this._TD=this.parts.cBody.el.find("td:nth(0)").clone(true)[0];this._TD.className="";this._TR=this.parts.rBody.el.find("tr:nth(0)").clone(true)[0];[...this._TR.attributes].map((t=>this._TR.removeAttribute(t.name)))}syncDim(t){let e=t._el||this._grid._el,s=e.prop("offsetTop"),i=e.prop("offsetLeft"),h=e.prop("offsetWidth"),l=e.prop("offsetHeight");this._el.css({top:s,left:i,width:h,height:l});let o=e.find(".tbl-title");s=o.prop("offsetHeight")+parseInt(o.css("margin-bottom"),10);s=isNaN(s)?0:s;this._rows.css({"--rows-top":`${s}px`});this._el.toggleClass("clip",!e.hasClass("clipped"));this._grid=t}syncRowsCols(t){let e=t._el||this._grid._el,s=[],i=[],h=this._cols.find("> div").html(""),l=this._rows.find("> div").html("");let o=e.find(".tbl-col-head > div");if(!o.length||!o.find("tr:nth(0) td").length){o=e.find(".tbl-body > div")}o.map(((t,e)=>{let i=$("tr:nth(0) td",t).map((t=>{let e=t.getBoundingClientRect();return`<td style="width: ${Math.round(e.width)}px;"><s></s></td>`}));if(e===0&&i.length)s.push("has-col-head");let l=Math.floor(t.firstChild.getBoundingClientRect().width);i=`<table style="width: ${l}px;"><tr>${i.join("")}</tr></table>`;h.get(e).html(i)}));this._cols.removeClass("has-col-head").addClass(s.join(" "));let a=e.find(".tbl-root > div > div:nth-child(1)");if(!a.find("tr").length){a=e.find(".tbl-root > div > div:nth-child(2)")}a.map(((t,e)=>{let s=$("tr",t).map((t=>`<tr style="height: ${t.offsetHeight}px;"><td><s></s></td></tr>`));if(e===0&&s.length)i.push("has-row-head");if(e===2&&s.length)i.push("has-row-foot");l.get(e).html(`<table>${s.join("")}</table>`)}));this.createClones();this._rows.removeClass("has-row-head has-row-foot").addClass(i.join(" "))}addRow(t,e="after"){let s=this._grid.layout.rows,i=t!==undefined?t:s.head+s.body-1,h;switch(true){case i<s.head:h="Head";break;case i>=s.head+s.body:h="Foot";i-=s.head+s.body;break;default:h="Body";i-=s.head+1}this.parts[`r${h}`].el.find(`tbody tr:nth(${i})`)[e](this._TR.cloneNode(true));this._el.css({height:this._grid._el.prop("offsetHeight")})}removeRow(t){let e=this._grid.layout.rows,s=t!==undefined?t:e.head+e.body-1,i;switch(true){case s<e.head:i="Head";break;case s>=e.head+e.body:i="Foot";s-=e.head+e.body;break;default:i="Body";s-=e.head}this.parts[`r${i}`].el.find(`tr:nth(${s})`).remove();this._el.css({height:this._grid._el.prop("offsetHeight")})}addCol(t,e="after"){let s=this._grid.layout.cols,i=t!==undefined?t:s.head+s.body-1,h,l;switch(true){case i<s.head:h="Head";break;default:h="Body";i-=s.head+1}l=this.parts[`c${h}`];l.el.find(`tr td:nth-child(${i+1})`)[e](this._TD.cloneNode(true));let o=l.el.find("td").reduce(((t,e)=>t+parseInt(e.style.width,10)),0);l.el.find("table").css({width:o});this._el.css({width:this._grid._el.prop("offsetWidth")})}removeCol(t){let e=this._grid.layout.cols,s=t!==undefined?t:e.head+e.body-1,i,h;switch(true){case s<e.head:i="Head";break;default:i="Body";s-=e.head}h=this.parts[`c${i}`];h.el.find(`tr td:nth-child(${s+1})`).remove();let l=h.el.find("td").reduce(((t,e)=>t+parseInt(e.style.width,10)),0);h.el.find("table").css({width:l});this._el.css({width:this._grid._el.prop("offsetWidth")})}unselect(){this._cols.find(".active").removeClass("active");this._rows.find(".active").removeClass("active")}select(t){let{cols:e,rows:s}=t;this.unselect();e.map((t=>this._cols.find("td").get(t).addClass("active")));s.map((t=>this._rows.find("tr").get(t).addClass("active")))}get rows(){return[...this._el.find(".table-rows td")]}get cols(){let t=this._el.find(".table-cols"),e=t.find("> div:nth-child(1) tr"),s=t.find("> div:nth-child(2) tr"),i=[];if(e.length)e.map(((t,e)=>i.push(...$("td",t),...s.get(e).find("td"))));else s.map(((t,e)=>i.push(...$("td",t))));return i}getRow(t){return $(this.rows[t])}getCol(t){return $(this.cols[t])}getRowIndex(t){return this.rows.indexOf(t)}getColIndex(t){return this.cols.indexOf(t)}}class Guides{static get selector(){return".xl-table, .xl-shape, .xl-image, .xl-text"}static get context(){return"content .body"}constructor(t={}){let e=eniac,s=karaqu.getSpawn(t.offset.el),i={selector:t.selector||Guides.selector,context:t.context||Guides.context,x:0,y:0,w:0,h:0,mh:t.offset.h>>1||0,mw:t.offset.w>>1||0,lines:t.lines||[],sensitivity:e.Settings["guides-snap-sensitivity"]||7,...t.offset};this.els=[...i.lines];s.find(i.selector,i.context).map((t=>{let e=$(t),s=parseInt(e.css("top"),10),h=parseInt(e.css("left"),10),l=parseInt(e.css("width"),10),o=parseInt(e.css("height"),10),a=o>>1,r=l>>1;if(e.hasClass("xl-table")){l+=1;o+=1;a=o>>1;r=l>>1}if(!isNaN(s)&&!isNaN(h)&&t!==i.el){this.els.push({y:s,x:h,w:l,h:o,mh:a,mw:r})}}));this.lines={horizontal:s.find(".guide-lines .horizontal"),vertical:s.find(".guide-lines .vertical"),diagonal:s.find(".guide-lines .diagonal")};this.opts=i}snapDim(t){let e=this.opts,s=e.sensitivity,i=t.uniform,h={t:e.type,d:t.diagonal,n:e.type.includes("n"),w:e.type.includes("w"),e:e.type.includes("e"),s:e.type.includes("s")},l={top:-99,left:-99,width:1},o={top:-99,left:-99,height:1},a={top:-99,left:-99,height:1},r=(s,h,l={h:0})=>{let o=e.x,a=s.x,r=s.w;t.height-=h.h;t.top-=h.t;if(a<o){o=s.x;a=e.x;r=e.w}if(i)n(true);return{top:s.y+l.h,left:o,width:a-o+r}},d=(s,h,l={w:0})=>{let o=e.y,a=s.y,r=s.h;t.width-=h.w;t.left-=h.l;if(a<o){o=s.y;a=e.y;r=e.h}if(i)n();return{top:o,left:s.x+l.w,height:a-o+r}},n=s=>{switch(h.t){case"ne":if(s){t.width=t.height*t.ratio;t.left=e.x-(t.height-e.h)*e.ratio}else{t.height=t.width/t.ratio;t.top=e.y-(t.width-e.w)/e.ratio}break;case"se":if(s){t.width=t.height*t.ratio;t.left=e.x-(t.height-e.h)*e.ratio}else{t.height=t.width/t.ratio}break;case"sw":if(s)t.width=t.height*t.ratio;else t.height=t.width/t.ratio;break;case"nw":if(s)t.width=t.height*t.ratio;else{t.height=t.width/t.ratio;t.top=e.y-(t.width-e.w)/e.ratio}break;case"e":case"w":t.top=e.y-((t.width-e.w)/e.ratio>>1);t.height=t.width/t.ratio;break;case"n":case"s":t.left=e.x-((t.height-e.h)*e.ratio>>1);t.width=t.height*t.ratio;break}};if(h.d){switch(h.t){case"ne":case"nw":t.height=Math.max(Math.round(t.width/t.ratio),t.min.h);t.top=Math.round(t.y+t.h-t.height);break;case"se":t.width=Math.max(Math.round(t.height*t.ratio),t.min.w);t.left=Math.round(t.x+t.w-t.width);break;case"sw":t.width=Math.max(Math.round(t.height*t.ratio),t.min.w);break}a={top:t.top||e.y,left:t.left||e.x,transform:`rotate(${e.r}deg)`,width:Math.sqrt(t.height*t.height+t.width*t.width)+10};if(e.r>90)a.left+=t.width}else if(i){switch(h.t){case"n":t.top=Math.round(t.y+t.h-t.height);t.width=Math.max(Math.round(t.height*t.ratio),t.min.w);t.left=e.x+(e.w-t.width>>1);break;case"s":t.width=Math.max(Math.round(t.height*t.ratio),t.min.w);t.left=e.x+(e.w-t.width>>1);break;case"e":case"w":t.height=Math.max(Math.round(t.width/t.ratio),t.min.h);t.top=Math.round(t.y+(t.h-t.height>>1));break}}this.els.map((a=>{let n=t.top-a.y,c=n-a.h,f=n-a.mh,p=t.height+e.y-a.y,u=p-a.h,g=p-a.mh,w=t.left-a.x,b=w-a.w,m=w-a.mw,y=t.width+e.x-a.x,_=y-a.w,x=y-a.mw,v={w:0,h:0,t:0,l:0};switch(true){case h.e&&w<s&&w>-s:v.l=w;v.w-=w;l=d(a,v);break;case h.e&&b<s&&b>-s:v.l=b;v.w-=b;l=d(a,v,{w:a.w});break;case h.e&&m<s&&m>-s:v.l=m;v.w-=m;l=d(a,v,{w:a.mw});break;case h.w&&y<s&&y>-s:v.w=y;l=d(a,v,{w:i?1:0});break;case h.w&&_<s&&_>-s:v.w=_;l=d(a,v,{w:a.w+(i?1:0)});break;case h.w&&x<s&&x>-s:v.w=x;l=d(a,v,{w:a.mw+(i?1:0)});break}switch(true){case h.n&&n<s&&n>-s:v.t=n;v.h-=n;o=r(a,v);break;case h.n&&c<s&&c>-s:v.t=c;v.h-=c;o=r(a,v,{h:a.h});break;case h.n&&f<s&&f>-s:v.t=f;v.h-=f;o=r(a,v,{h:a.mh});break;case h.s&&p<s&&p>-s:v.h=p;o=r(a,v,{h:i?-1:0});break;case h.s&&u<s&&u>-s:v.h=u;o=r(a,v,{h:a.h+(i?-1:0)});break;case h.s&&g<s&&g>-s:v.h=g;o=r(a,v,{h:a.mh+(i?-1:0)});break}}));this.lines.vertical.css(l);this.lines.horizontal.css(o);this.lines.diagonal.css(a)}snapPos(t){let e=this.opts,s=e.sensitivity,i=t.top+e.y,h=t.left+e.x,l={top:-1,left:-1,width:1},o={top:-1,left:-1,height:1},a=(s,i,l={t:0})=>{let o=h,a=s.x,r=a-o+s.w;if(r<e.w)r=e.w;t.top-=i;if(a<o){o=s.x;a=h;r=a-o+e.w;if(r<s.w)r=s.w}return{top:s.y+l.t,left:o,width:r}},r=(s,h,l={l:0})=>{let o=i,a=s.y,r=a-o+s.h;if(r<e.h)r=e.h;t.left-=h;if(a<o){o=s.y;a=i;r=a-o+e.h;if(r<s.h)r=s.h}return{top:o,left:s.x+l.l,height:r}};if(t.restrict){let s=t.top-e.t,i=t.left-e.l,h=["h","ne","v","nw","h","ne","v","nw","h"],l=Math.round(Math.atan2(s,i)*180/Math.PI);if(l<0)l+=360;switch(h[Math.round(l/45)]){case"v":t.left=e.l;break;case"h":t.top=e.t;break;case"ne":t.left=e.l+(t.top-e.t);break;case"nw":t.left=e.l-(t.top-e.t);break}}this.els.map((t=>{let d=i-t.y,n=h-t.x,c=d+e.h,f=d+e.mh,p=c-t.h-e.mh,u=d-t.h,g=c-t.h,w=c-t.mh-e.mh,b=n+e.w,m=n+e.mw,y=b-t.w-e.mw,_=n-t.w,x=b-t.w,v=b-t.mw-e.mw,k=o.top!==-1,C=l.top!==-1;switch(true){case!k&&d<s&&d>-s:o=a(t,d);break;case!k&&c<s&&c>-s:o=a(t,c);break;case!k&&f<s&&f>-s:o=a(t,f);break;case!k&&p<s&&p>-s:o=a(t,p,{t:t.h});break;case!k&&w<s&&w>-s:o=a(t,w,{t:t.mh});break;case!k&&u<s&&u>-s:o=a(t,u,{t:t.h-1});break;case!k&&g<s&&g>-s:o=a(t,g,{t:t.h-1});break}switch(true){case!C&&n<s&&n>-s:l=r(t,n);break;case!C&&b<s&&b>-s:l=r(t,b);break;case!C&&m<s&&m>-s:l=r(t,m);break;case!C&&y<s&&y>-s:l=r(t,y,{l:t.w});break;case!C&&v<s&&v>-s:l=r(t,v,{l:t.mw});break;case!C&&_<s&&_>-s:l=r(t,_,{l:t.w-1});break;case!C&&x<s&&x>-s:l=r(t,x,{l:t.w-1});break}}));this.lines.vertical.css(l);this.lines.horizontal.css(o)}reset(){let t={top:-99,left:-99,width:1,height:1};this.lines.vertical.css(t);this.lines.horizontal.css(t);this.lines.diagonal.css(t)}}class Edit{constructor(t){this._el=t.el;this._type=t.type;this._keys={bold:"bold",italic:"italic",underline:"underline",strikeThrough:"strikeThrough",left:"justifyLeft",center:"justifyCenter",right:"justifyRight",justify:"justifyFull"};this.format("styleWithCSS",true);this.format("defaultParagraphSeparator","p")}format(t,e){let s=this._keys[t]||t,i=new $election,h;if(i._root){i.save();if(i.collapsed)i.expand("word")}switch(s){case"font-family":s="fontName";break;case"font-color":s="ForeColor";break;case"font-size":e=`<span style="font-size: ${e}px;">${i.toString()}</span>`;s="insertHTML";break}document.execCommand(s,false,e||null);if(i._root)i.restore()}state(){let t=this._el,e=new $election,s=$(e.container),i,h=Color.rgbToHex(document.queryCommandValue("ForeColor")).slice(0,-2),l=s.css("font-family"),o=parseInt(s.css("font-size"),10),a=parseInt(s.css("line-height"),10);t.find(`.color-preset_[data-change="set-${this._type}-color"]`).css({"--preset-color":h});if(l.startsWith('"')&&l.endsWith('"')){l=l.slice(1,-1)}t.find(`selectbox[data-change="set-${this._type}-font-family"]`).val(l);t.find(`input[name="${this._type}-font-size"]`).val(o);i=(a/o).toFixed(1).toString();t.find(`selectbox[data-menu="${this._type}-line-height"]`).val(i);Object.keys(this._keys).map((e=>{let s=this._keys[e],i=document.queryCommandState(s);t.find(`[data-name="${e}"]`).toggleClass("active_",!i)}))}}class $election{constructor(t,e,s){this._selection=document.getSelection();if(t&&e!==false)this.select(...arguments);this._root=this.getRoot()}expand(t){switch(t){case"word":this._selection.collapseToStart();this._selection.modify("move","backward","word");this._selection.modify("extend","forward","word");break}}get container(){let t=this._selection.focusNode;if(t.nodeType==Node.TEXT_NODE)t=t.parentNode;return t}get collapsed(){return this._selection.getRangeAt(0).collapsed}get type(){return this._selection.type}collapse(t,e){if(this.collapsed)return;t=t||this._anchorNode;e=e||this._anchorOffset;this._selection.collapse(t,e)}toString(){return this._selection.toString()}save(){let t=this.getOnlyTextNodes(this._root),e=this._selection.anchorNode,s=Math.min(this._selection.anchorOffset,this._selection.focusOffset),i=t.indexOf(e)+1,h=0,l;while(i--){l=t[i].nodeValue.toString();if(t[i]===e){l=l.slice(0,s)}h+=l.length}this._startOffset=h;l=this._selection.toString().replace(/\n/g,"");this._endOffset=l.length}restore(){if(!this._root)return;this.select(this._root,this._startOffset,this._endOffset)}select(t,e,s){let i=document.createRange(),h=t.nodeType===3?[t]:this.getOnlyTextNodes(t),l,o=e,a,r=s,d=h.length,n=0,c;for(;n<d;n++){l=h[n];if(l.nodeValue.length>=o)break;o-=l.nodeValue.length}if(s){for(;n<d;n++){a=h[n];c=a.nodeValue;if(a===l)c=c.slice(o);if(c.length>=r)break;r-=c.length}if(l===a)r+=o}else{a=l;r=o}i.setStart(l,o);i.setEnd(a,r);this._selection.removeAllRanges();this._selection.addRange(i)}getOnlyTextNodes(t){let e=[];t.childNodes.map((t=>{switch(t.nodeType){case Node.TEXT_NODE:e.push(t);break;case Node.ELEMENT_NODE:e.push(...this.getOnlyTextNodes(t));break}}));return e}getRoot(){let t=this._selection.baseNode;if(!t)return;while(t.nodeType!==Node.ELEMENT_NODE||!t.getAttribute("contenteditable")){t=t.parentNode}return t}}const CSV={possibleDelimiters:[",",";","\t"],parse(t){let e=eniac,s=[],i=400,h=190,l=40,o=40,a=e.spawn.els.body.find(Guides.selector).length,r=`top:${l}px; left:${o}px; z-index:${a}`,d=this.detectDelimiter(t);s.push(`<Workbook>`);s.push(`<Sheet name="Sheet 1">`);s.push(`<Table width="${i}" height="${h}" style="${r}">`);t.trim().split("\n").map((t=>{let e="";t.split(d).map((t=>{let s=t.trim();if(s.startsWith('"')&&s.endsWith('"')){s=s.slice(1,-1)}let i=s==new Number(s)?`t="n"`:"";e+=`<C ${i}><![CDATA[${s}]]></C>`}));s.push(`<R tp="2">${e}</R>`)}));s.push(`</Table>`);s.push(`</Sheet>`);s.push(`</Workbook>`);return $.xmlFromString(s.join("")).documentElement},detectDelimiter(t){let e=e=>{let s=-1,i=t=>{if(!t)return true;let i=t.split(e).length;if(s<0)s=i;return s===i&&i>1};return t.split("\n").every(i)};return this.possibleDelimiters.filter(e)},export(t){}};const Color={rgbToLightness(t,e,s){return 1/2*(Math.max(t,e,s)+Math.min(t,e,s))/255},rgbToSaturation(t,e,s){let i=this.rgbToLightness(t,e,s),h=Math.max(t,e,s),l=Math.min(t,e,s);return i===0||i===1?0:(h-l)/(1-Math.abs(2*i-1))/255},rgbToHue(t,e,s){let i=Math.round(Math.atan2(Math.sqrt(3)*(e-s),2*t-e-s)*180/Math.PI);return i<0?i+360:i},hslToRgb(t,e,s,i=1){let h=Math.round,l=Math.min,o=Math.max,a=e*l(s,1-s);let r=(e,i=(e+t/30)%12)=>s-a*o(l(i-3,9-i,1),-1);return[h(r(0)*255),h(r(8)*255),h(r(4)*255),i]},hslToHex(t,e,s,i=1){let h=this.hslToRgb(t,e,s,i);return this.rgbToHex(`rgba(${h.join(",")})`)},hexToHsl(t){let e=this.hexToRgb(t);return this.rgbToHsl(...e)},mixColors(t,e,s){let i=this.hexToRgb(t),h=this.hexToRgb(e),l=s*2-1,o=(l+1)/2,a=1-o,r=[parseInt(i[0]*o+h[0]*a,10),parseInt(i[1]*o+h[1]*a,10),parseInt(i[2]*o+h[2]*a,10),i[3]*o+h[3]*a];return this.rgbToHex(`rgba(${r.join(",")})`)},hexToHsv(t){let e=this.hexToRgb(t);return this.rgbToHsv(...e)},rgbToHsv(t,e,s,i=1){var h=Math.max(t,e,s),l=Math.min(t,e,s),o=h-l,a,r=h===0?0:o/h,d=h/255;switch(h){case l:a=0;break;case t:a=e-s+o*(e<s?6:0);a/=6*o;break;case e:a=s-t+o*2;a/=6*o;break;case s:a=t-e+o*4;a/=6*o;break}return[Math.round(a*360),r,d,i]},hexToRgb(t){if(t.length===4){let[e,s,i,h]=t.split("");t=e+s+s+i+i+h+h}let e=parseInt(t.substr(1,2),16),s=parseInt(t.substr(3,2),16),i=parseInt(t.substr(5,2),16),h=parseInt(t.substr(7,2)||"ff",16)/255;return[e,s,i,h]},rgbToHsl(t,e,s,i=1){t/=255;e/=255;s/=255;var h=Math.max(t,e,s),l=Math.min(t,e,s),o=(h+l)/2,a,r;if(h==l){a=r=0}else{var d=h-l;r=o>.5?d/(2-h-l):d/(h+l);switch(h){case t:a=(e-s)/d+(e<s?6:0);break;case e:a=(s-t)/d+2;break;case s:a=(t-e)/d+4;break}a/=6}return[Math.round(a*360),r,o,i]},rgbToHex(t){let e="0123456789abcdef".split(""),s=t=>isNaN(t)?"00":e[(t-t%16)/16]+e[t%16];t=t.match(/^rgba\((\d+),\s*(\d+),\s*(\d+),\s*([\.\d]+)\)$/);if(!t)t=arguments[0].match(/^rgb?\((\d+),\s*(\d+),\s*(\d+)\)$/);let i=Math.round((t[4]||1)*255);return"#"+s(t[1])+s(t[2])+s(t[3])+s(i)}};